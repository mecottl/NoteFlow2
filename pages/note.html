<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Editor de nota - Cybernet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn-glow { box-shadow: 0 0 5px #a78bfa, 0 0 15px #a78bfa; transition:.3s; }
    .btn-glow:hover { box-shadow: 0 0 10px #c084fc, 0 0 25px #c084fc, 0 0 40px #c084fc; transform: scale(1.03); }
    .input-glow {
      box-shadow: 0 0 0px rgba(167, 139, 250, 0);
      transition: all 0.3s ease-in-out;
    }
    .input-glow:focus {
      box-shadow: 0 0 8px rgba(167, 139, 250, 0.6);
      border-color: #a78bfa;
    }
    .border-gradient-thin {
      border-image: linear-gradient(to right, #a78bfa, #c084fc) 1;
      border-width: 1px;
      border-style: solid;
    }
    .bg-circuit-pattern-subtle {
      background-image: url('/placeholder.svg?height=100&width=100');
      background-size: 50px 50px;
      opacity: 0.03;
      position: absolute;
      inset: 0;
      z-index: 0;
    }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 font-mono min-h-screen flex flex-col relative overflow-hidden">
  <div class="bg-circuit-pattern-subtle"></div>

  <header class="p-4 border-b-2 border-purple-800 shadow-lg shadow-purple-900/30 relative z-10">
    <div class="container mx-auto flex items-center justify-between">
      <a href="notes.html" class="text-purple-400 hover:text-purple-300 flex items-center gap-2 text-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        Volver a Notas
      </a>
      <h1 id="pageTitle" class="text-2xl font-bold text-purple-400"></h1>
      <div class="w-20"></div>
    </div>
  </header>

  <main class="container mx-auto flex-1 p-8 flex flex-col gap-6 relative z-10">
    <div id="status" class="text-sm text-gray-400"></div>

     Campo para el título de la nota 
    <input type="text" id="noteTitle"
      class="w-full bg-gray-900 border-2 border-purple-800 rounded-lg p-4 text-3xl font-bold text-purple-300 placeholder-purple-500/50 focus:outline-none focus:ring-2 focus:ring-purple-600 input-glow"
      placeholder="Título de la nota AI..."
      aria-label="Título de la nota">

     Editor grande para el contenido 
    <textarea id="editor"
      class="flex-1 w-full bg-gray-900 border-2 border-purple-800 rounded-lg p-6 text-gray-200 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-600 input-glow"
      placeholder="Escribe tu nota aquí. La IA te ayudará a organizarla y generar ideas..."
      style="min-height: 60vh;"
      aria-label="Contenido de la nota"></textarea>

    <div class="flex flex-col sm:flex-row gap-4 justify-end">
      <button id="deleteBtn" class="px-8 py-4 bg-red-700 text-white rounded-full shadow-lg hover:bg-red-600 transition-all duration-300 transform hover:scale-105 text-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2 inline-block mr-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
        Eliminar Nota
      </button>
      <button id="saveBtn" class="px-8 py-4 bg-purple-700 text-white rounded-full shadow-lg btn-glow flex items-center justify-center gap-3 text-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        Guardar Cambios
      </button>
    </div>
  </main>

  <footer class="p-6 text-center text-gray-500 text-sm border-t-2 border-purple-800 shadow-inner shadow-purple-900/30 relative z-10">
    &copy; 2025 CYBERNET AI. All rights reserved.
  </footer>

  <script>
    const API_BASE = '/api';
    const token = localStorage.getItem('token');
    if (!token) location.href = 'login.html';

    const params = new URLSearchParams(location.search);
    const id = params.get('id'); // si existe, estamos editando
    const pageTitleEl = document.getElementById('pageTitle');
    const noteTitleInput = document.getElementById('noteTitle'); // Nuevo campo para el título
    const editor = document.getElementById('editor');
    const statusEl = document.getElementById('status');
    const saveBtn = document.getElementById('saveBtn');
    const deleteBtn = document.getElementById('deleteBtn'); // Botón de eliminar

    function setStatus(msg, cls='text-gray-400'){ statusEl.className = `text-sm ${cls}`; statusEl.textContent = msg || ''; }

    async function loadNote(){
      if (!id) { // Nueva nota
        pageTitleEl.textContent = 'Nueva Nota AI';
        deleteBtn.style.display = 'none'; // Ocultar botón de eliminar para nuevas notas
        return;
      }
      // Editando nota existente
      pageTitleEl.textContent = `Editando Nota #${id}`;
      setStatus('Cargando nota...');
      try{
        const res = await fetch(`${API_BASE}/notes/${id}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (res.status === 401){ localStorage.removeItem('token'); return location.href='login.html'; }
        if (!res.ok) throw new Error('No se pudo cargar la nota');
        const note = await res.json();
        noteTitleInput.value = note.title || ''; // Cargar título
        editor.value = note.text || ''; // Cargar contenido
        setStatus('');
      }catch(e){
        console.error(e);
        setStatus('Error cargando la nota.', 'text-red-400');
      }
    }

    async function saveNote(){
      const title = noteTitleInput.value.trim(); // Obtener título
      const text = editor.value.trim();
      if (!title && !text){ setStatus('La nota y el título están vacíos.', 'text-yellow-400'); return; }
      if (!title){ setStatus('El título no puede estar vacío.', 'text-yellow-400'); return; } // Validar título

      saveBtn.disabled = true; saveBtn.classList.add('opacity-70','cursor-not-allowed');
      try{
        if (id){
          const res = await fetch(`${API_BASE}/notes/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type':'application/json', Authorization: `Bearer ${token}` },
            body: JSON.stringify({ title, text }) // Enviar título y texto
          });
          if (!res.ok) throw new Error('No se pudo actualizar la nota');
        } else {
          const res = await fetch(`${API_BASE}/notes`, {
            method: 'POST',
            headers: { 'Content-Type':'application/json', Authorization: `Bearer ${token}` },
            body: JSON.stringify({ title, text }) // Enviar título y texto
          });
          if (!res.ok) throw new Error('No se pudo crear la nota');
        }
        location.href = 'notes';
      }catch(e){
        console.error(e);
        setStatus(e.message, 'text-red-400');
      }finally{
        saveBtn.disabled = false; saveBtn.classList.remove('opacity-70','cursor-not-allowed');
      }
    }

    async function deleteNote(){
      if (!id) return; // No se puede eliminar una nota que no existe
      if (!confirm('¿Estás seguro de que quieres eliminar esta nota? Esta acción no se puede deshacer.')){ return; }

      deleteBtn.disabled = true; deleteBtn.classList.add('opacity-70','cursor-not-allowed');
      try{
        const res = await fetch(`${API_BASE}/notes/${id}`, {
          method: 'DELETE',
          headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) throw new Error('No se pudo eliminar la nota');
        location.href = 'notes';
      }catch(e){
        console.error(e);
        setStatus(e.message, 'text-red-400');
      }finally{
        deleteBtn.disabled = false; deleteBtn.classList.remove('opacity-70','cursor-not-allowed');
      }
    }

    saveBtn.addEventListener('click', saveNote);
    deleteBtn.addEventListener('click', deleteNote); // Event listener para el botón de eliminar
    loadNote();
  </script>
</body>
</html>
