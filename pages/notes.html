<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>My AI Notes - Cybernet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .btn-glow { box-shadow: 0 0 5px #a78bfa, 0 0 15px #a78bfa; transition: .3s; }
    .btn-glow:hover { box-shadow: 0 0 10px #c084fc, 0 0 25px #c084fc, 0 0 40px #c084fc; transform: scale(1.05); }
    .card-glow { box-shadow: 0 0 5px rgba(167,139,250,.4); transition: .3s; }
    .card-glow:hover { box-shadow: 0 0 15px rgba(192,132,252,.8); transform: translateY(-5px); }
    .line-clamp-3 { display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }
  </style>
</head>
<body class="bg-gray-950 text-gray-100 font-mono min-h-screen flex flex-col">

  <header class="p-6 border-b-2 border-purple-800 shadow-lg shadow-purple-900/30">
    <nav class="container mx-auto flex justify-between items-center">
      <a href="/notes" class="text-3xl font-extrabold text-purple-400 hover:text-purple-300 transition-colors tracking-wider">
        CYBERNET AI
      </a>
      <div class="space-x-8 text-lg">
        <a href="/notes" class="text-gray-300 hover:text-purple-400 transition-colors">Notes</a>
        <a id="logoutLink" href="/login" class="text-gray-300 hover:text-purple-400 transition-colors">Cerrar sesi√≥n</a>
      </div>
    </nav>
  </header>

  <main class="flex-grow container mx-auto p-8">
    <div class="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-purple-700 pb-6">
      <h1 class="text-4xl md:text-5xl font-bold text-purple-400 mb-4 md:mb-0">Mis Notas</h1>

      <!-- Nueva nota: navega al editor -->
      <a href="/note" class="px-6 py-3 bg-purple-700 text-white rounded-full shadow-lg btn-glow flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M12 5v14"/><path d="M5 12h14"/>
        </svg>
        Nueva nota
      </a>
    </div>

    <div id="status" class="mb-6 text-sm text-gray-400"></div>
    <div id="notesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
  </main>

  <footer class="p-6 text-center text-gray-500 text-sm border-t-2 border-purple-800 shadow-inner shadow-purple-900/30">
    &copy; 2025 CYBERNET AI. All rights reserved.
  </footer>

  <script>
    const API_BASE = '/api';
    const grid = document.getElementById('notesGrid');
    const statusEl = document.getElementById('status');
    const logoutLink = document.getElementById('logoutLink');
    const token = localStorage.getItem('token');
    if (!token) window.location.href = '/login';

    function setStatus(msg, cls='text-gray-400'){
      statusEl.className = `mb-6 text-sm ${cls}`;
      statusEl.textContent = msg || '';
    }
    const fmt = iso => !iso ? '' : new Date(iso).toLocaleString();

    function card(note){
      const a = document.createElement('a');
      a.href = `/note?id=${note.id}`;
      a.className = 'block bg-gray-900 p-7 rounded-xl shadow-xl border-2 border-purple-900 card-glow';
      a.innerHTML = `
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-2xl font-semibold text-purple-400">${(note.title || `Nota #${note.id}`)}</h3>
          <span class="text-purple-500 text-xs">${fmt(note.updated_at || note.created_at)}</span>
        </div>
        <p class="text-gray-300 text-sm mb-1 line-clamp-3">${(note.text || '').replace(/</g,'&lt;')}</p>
      `;
      return a;
    }

    async function loadNotes(){
      setStatus('Cargando notas...');
      grid.innerHTML = '';
      try{
        const res = await fetch(`${API_BASE}/notes`, { headers: { Authorization: `Bearer ${token}` }});
        if (res.status === 401){ localStorage.removeItem('token'); return location.href='/login'; }
        if (!res.ok) throw new Error('No se pudieron cargar las notas');
        const notes = await res.json();
        if (!Array.isArray(notes) || notes.length===0){ setStatus('Sin notas. Crea la primera arriba.'); return; }
        setStatus('');
        notes.forEach(n => grid.appendChild(card(n)));
      }catch(e){
        console.error(e);
        setStatus('Error cargando notas.', 'text-red-400');
      }
    }

    logoutLink.addEventListener('click', (ev)=>{ ev.preventDefault(); localStorage.removeItem('token'); location.href='/login'; });
    loadNotes();
  </script>
</body>
</html>
